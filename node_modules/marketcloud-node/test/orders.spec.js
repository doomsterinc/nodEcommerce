var marketcloud = require('../index.js'),
	mocha = require('mocha'),
	chai = require('chai');

var expect = chai.expect,
	Promise = marketcloud.Promise;

var client = null;
var order_id = null;
var the_shipping_method = null;
var the_user, the_address, the_products = null;
describe('Orders', function() {

	before(function(done) {

		client = new marketcloud.Client({
			public_key : process.env.MARKETCLOUD_PUBLIC_KEY,
    		secret_key : process.env.MARKETCLOUD_SECRET_KEY
		})
		return client.products.list({
				per_page: 2
			})
			.then(function(response) {
				the_products = response;

				return client.shippings.list();
				
			})
			.then(function(response){
				console.log("GLI SHIPP",response);
				the_shipping_method = response[0];
			})
	})



	it('Should retrieve a list of orders', function() {
		return client.orders.list({})
			.then(function(response) {
				
				expect(response.length).to.not.equal(0);
				expect(response.length).to.be.at.most(20);
				order_id = response[0].id;

			})
	});


	it('Should retrieve a specific order', function() {
		return client.orders.getById(order_id)
			.then(function(response) {
				
				expect(response.id).to.equal(order_id);

			})
	});

	it('Should create a order', function() {


		var order = {
			"items": [{
				"product_id": the_products[0].id,
				"quantity": 1,
				"variant_id": 0
			},{
				"product_id": the_products[0].id,
				"quantity": 1,
				"variant_id": 0
			}],
			"shipping_id" : the_shipping_method.id,
			"shipping_address": {
				"full_name": "Mattia Alfieri",
				"user_id": 13362,
				"address1": "Via Tiziano 78",
				"address2": "Interno 6",
				"city": "Ancona",
				"country": "Italy",
				"postal_code": "60125",
				"phone_number": "+39 3477256829",
				"email": "uwem33@example.com"
			},
			"billing_address": {
				"full_name": "Mattia Alfieri",
				"user_id": 13362,
				"address1": "Via Tiziano 78",
				"address2": "Interno 6",
				"city": "Ancona",
				"country": "Italy",
				"postal_code": "60125",
				"phone_number": "+39 3477256829",
				"email": "uwem33@example.com"
			}
		}
		return client.orders.create(order)
			.then(function(response) {
				var order_id = response.id
				
			})

	})

	/*it('Should delete a order', function() {
		return client.orders.delete(order_id)
			.then(function(response) {
				
			})
	})*/


})