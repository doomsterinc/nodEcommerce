var marketcloud = require('../index.js'),
	mocha = require('mocha'),
	chai = require('chai');

var expect = chai.expect;

var client = null;
var product_id = null;
var cart_id = null;

describe('Carts',function(){

	before(function(){

		client = new marketcloud.Client({
			public_key : process.env.MARKETCLOUD_PUBLIC_KEY,
    		secret_key : process.env.MARKETCLOUD_SECRET_KEY
		})
	})


	it('Should retrieve a list of products',function(){
		return client.products.list({})
			.then(function(response){
				
				expect(response.length).to.not.equal(0);
				product_id = response[0].id;

			})
	});


	it('Should create an empty cart',function(){
		return client.carts.create()
			.then(function(response){
				
				cart_id = response.id;
				console.log("response",response)
				
			})
	})

	it('Should add a product to the cart',function(){
		return client.carts.add(cart_id,[{product_id : product_id, quantity : 1}])
					.then(function(response){
						
						expect(response.items.length).to.equal(1)
						expect(response.items[0].quantity).to.equal(1)
					})

	})

	it('Should update a product in cart',function(){
		return client.carts.update(cart_id,[{product_id : product_id, quantity : 10}])
					.then(function(response){
						
						expect(response.items.length).to.equal(1)
						expect(response.items[0].quantity).to.equal(10)
					})						
	})

	it('Should remove a product from the cart',function(){
		return client.carts.remove(cart_id,[{product_id : product_id}])
					.then(function(response){
						
						expect(response.items.length).to.equal(0)
					})						
	})

	
})
