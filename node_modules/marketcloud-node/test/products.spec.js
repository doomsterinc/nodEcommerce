var marketcloud = require('../index.js'),
	mocha = require('mocha'),
	chai = require('chai');

var expect = chai.expect;

var client = null;
var product_id = null;
describe('Products',function(){

	before(function(){

		client = new marketcloud.Client({
			public_key : process.env.MARKETCLOUD_PUBLIC_KEY,
    		secret_key : process.env.MARKETCLOUD_SECRET_KEY
		})
	})

	it('Should NOT find a non-existing product',function(){
		return client.products.getById(1)
				.catch(function(response){
					expect(response.code).to.equal(404)
				})
	})

	it('Should retrieve a list of products',function(){
		return client.products.list({})
			.then(function(response){
				expect(response.length).to.not.equal(0);
				expect(response.length).to.be.at.most(20);
				product_id = response[0].id;
			})
	});


	it('Should retrieve a specific product',function(){
		return client.products.getById(product_id)
			.then(function(response){
				
				expect(response.id).to.equal(product_id);
				
			})
	})

	it('Should create a product',function(){
		var product = {
			name : 'The courtyard',
			price : 9.99,
			pages : "111",
			stock_type : 'track',
			stock_level : 10,
			author : 'Alan Moore',
			publisher : 'Avatar Press',
			images : ['http://ecx.images-amazon.com/images/I/51Anf1KLVhL._SY344_BO1,204,203,200_.jpg']
		}
		return client.products.create(product)
					.then(function(response){
						var product_id = response.id
						console.log("ER PRODUCT_ID",response.id)
						
					})

	})

	it('Should update a product',function(){
		var update = {
			price : 19.99,
			stock_level:5
		}
		return client.products.update(product_id,update)
								.then(function(response){
									
									expect(response.price).to.equal(19.99)
									expect(response.stock_level).to.equal(5)
								})

	})

	it('Should delete a product',function(){
		return client.products.delete(product_id)
								.then(function(response){
									
								})
	})

	
})
