var marketcloud = require('../index.js'),
	mocha = require('mocha'),
	chai = require('chai');

var expect = chai.expect;

var client = null;
var address_id = null;
describe('Addresses',function(){

	before(function(){

		client = new marketcloud.Client({
			public_key : process.env.MARKETCLOUD_PUBLIC_KEY,
    		secret_key : process.env.MARKETCLOUD_SECRET_KEY
		})

		return client.authenticate()

		
	})


	it('Should retrieve a list of addresses',function(){
		return client.addresses.list({})
			.then(function(response){
				
				expect(response.length).to.not.equal(0);
				expect(response.length).to.be.at.most(20);
				address_id = response[0].id;

			})
	});


	it('Should retrieve a specific address',function(){
		return client.addresses.getById(address_id)
			.then(function(response){
				
				expect(response.id).to.equal(address_id);
				
			})
	})

	it('Should create a address',function(){
		var address = {
			"full_name": "Mattia Alfieri",
		    "address1": "Via Tiziano 79",
		    "address2" : "Interno 6",
		    "city" : "Ancona",
		    "country" : "Italy",
		    "state" :  "Marche",
		    "postal_code" : "60125",
		    "phone_number" : "+39 3477256829",
		    "email" : "cikkense@gmail.com"
		}
		return client.users.list()
		.then(function(response){
			address.user_id = response[0].id;
			return client.addresses.create(address)
		})
		.then(function(response){
			var address_id = response.id
			
		})
		

	})

	it('Should update a address',function(){
		var update = {
			full_name : 'Mattia Pablo Alfieri'
		}
		return client.addresses.update(address_id,update,false)
								.then(function(response){
									expect(response.id).to.equal(address_id)
								})
	})


	it('Should delete a address',function(){
		return client.addresses.delete(address_id)
								.then(function(response){
									
								})
	})

	
})